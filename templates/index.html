<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brainrot DEBUG</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 20px; font-size: 12px; }
        #log-container { border: 1px solid #333; padding: 10px; margin-top: 20px; white-space: pre-wrap; word-wrap: break-word; }
        .btn { padding: 15px; background: #333; color: white; border: 1px solid #fff; margin-top: 20px; display: block; width: 100%; text-align: center; text-decoration: none; font-size: 16px;}
        h1 { color: #fff; }
    </style>
</head>
<body>

    <h1>DEBUG MODE v2</h1>
    <div id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    <div id="log-container">Logs will appear here...<br></div>
    
    <button class="btn" onclick="location.reload()">–ü–ï–†–ï–ó–ê–ì–†–£–ó–ò–¢–¨</button>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä—è–º–æ –Ω–∞ —ç–∫—Ä–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function logger(msg) {
            const box = document.getElementById('log-container');
            const time = new Date().toTimeString().split(' ')[0];
            box.innerHTML += `[${time}] ${msg}\n`;
            console.log(msg);
        }

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ JS
        window.onerror = function(message, source, lineno, colno, error) {
            logger(`‚ùå CRITICAL ERROR: ${message} at line ${lineno}`);
            document.getElementById('status').innerText = "–û–®–ò–ë–ö–ê –°–ö–†–ò–ü–¢–ê";
            document.getElementById('status').style.color = "red";
        };

        async function init() {
            try {
                logger("üöÄ –°—Ç–∞—Ä—Ç —Å–∫—Ä–∏–ø—Ç–∞...");
                
                // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram API
                if(window.Telegram && window.Telegram.WebApp) {
                    logger("‚úÖ Telegram SDK –Ω–∞–π–¥–µ–Ω");
                    window.Telegram.WebApp.expand();
                } else {
                    logger("‚ö†Ô∏è Telegram SDK –Ω–µ –Ω–∞–π–¥–µ–Ω (–∑–∞–ø—É—Å–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ?)");
                }

                // 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ URL API
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –¥–æ–º–µ–Ω–∞
                const API_URL = '/api/data'; 
                logger(`üîó –¶–µ–ª—å –∑–∞–ø—Ä–æ—Å–∞: ${window.location.origin}${API_URL}`);

                // 3. –î–∞–Ω–Ω—ã–µ —é–∑–µ—Ä–∞
                let userData = { user_id: 0, username: 'BrowserUser', photo_url: '' };
                if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
                    const u = window.Telegram.WebApp.initDataUnsafe.user;
                    userData = { user_id: u.id, username: u.username, photo_url: u.photo_url };
                    logger(`üë§ –Æ–∑–µ—Ä: ${u.id} (${u.username})`);
                } else {
                    logger("üë§ –Æ–∑–µ—Ä –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)");
                }

                // 4. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
                logger("‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ POST –∑–∞–ø—Ä–æ—Å–∞...");
                document.getElementById('status').innerText = "–ó–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É...";

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });

                logger(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);

                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(`Server Error ${response.status}: ${text.slice(0, 50)}`);
                }

                // 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                logger("üì¶ –ß–∏—Ç–∞–µ–º JSON...");
                const data = await response.json();
                logger("‚úÖ JSON –ø–æ–ª—É—á–µ–Ω!");
                
                if(data.user) {
                    document.getElementById('status').innerText = "–£–°–ü–ï–®–ù–û!";
                    document.getElementById('status').style.color = "#0f0";
                    logger(`üí∞ –ë–∞–ª–∞–Ω—Å: ${data.user.balance}`);
                    logger(`üéí –ü—Ä–µ–¥–º–µ—Ç–æ–≤: ${data.inventory.length}`);
                    
                    // –ï—Å–ª–∏ –º—ã –∑–¥–µ—Å—å - –∑–Ω–∞—á–∏—Ç —Å–≤—è–∑—å –µ—Å—Ç—å. 
                    // –ú–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–æ –ø–æ–∫–∞ —Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏.
                } else {
                    throw new Error("JSON –ø—É—Å—Ç–æ–π –∏–ª–∏ –∫—Ä–∏–≤–æ–π");
                }

            } catch (e) {
                logger(`‚ùå CATCH: ${e.name} - ${e.message}`);
                document.getElementById('status').innerText = "–°–ë–û–ô –ó–ê–ì–†–£–ó–ö–ò";
                document.getElementById('status').style.color = "red";
            }
        }

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>